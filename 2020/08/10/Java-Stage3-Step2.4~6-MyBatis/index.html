<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tukekenulia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="主要步骤：1、MyBatis介绍和配置 2、连接数据库工具类MyBatisUtils 3、数据查询，插入，更新，删除操作 4、日志配置及查看 5、动态sql语句 6、二级缓存 7、1对多 ，多对1关联查询 8、分页查询插件 9、连接缓冲池C3P0 10、批量插入 11、注解开发 12、项目开发总结">
<meta property="og:type" content="article">
<meta property="og:title" content="Tukekenulia">
<meta property="og:url" content="http://yoursite.com/2020/08/10/Java-Stage3-Step2.4~6-MyBatis/index.html">
<meta property="og:site_name" content="Tukekenulia">
<meta property="og:description" content="主要步骤：1、MyBatis介绍和配置 2、连接数据库工具类MyBatisUtils 3、数据查询，插入，更新，删除操作 4、日志配置及查看 5、动态sql语句 6、二级缓存 7、1对多 ，多对1关联查询 8、分页查询插件 9、连接缓冲池C3P0 10、批量插入 11、注解开发 12、项目开发总结">
<meta property="og:locale">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/1.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/4.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/2.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/3.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/5.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/6.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/7.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/8.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/9.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/10.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/11.png">
<meta property="og:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/12.png">
<meta property="article:published_time" content="2020-08-10T07:30:46.000Z">
<meta property="article:modified_time" content="2020-08-10T07:30:46.000Z">
<meta property="article:author" content="Tukeke">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/Java-Stage3-Step2.4~5-MyBatis/1.png">
  
  
    <link rel="icon" href="/11.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">Tukekenulia</div>
      
        <div id="subtitle">Stay focus,stay humble,stay curiosity.</div>
      
       <ul class="my-socials">
  
  <li>
  	<a href="https://github.com/Tukekehaohaonuli" class="github" target="_blank">
  		<i class="fa fa-github"></i>
  	</a>
  </li>
  
  <li>
  	<a href="YOUR WEIBO HOME PAGE URL" class="weibo" target="_blank">
  		<i class="fa fa-weibo"></i>
  	</a>
  </li>
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">Tukekenulia</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="yoursite.com">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Java-Stage3-Step2.4~6-MyBatis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/10/Java-Stage3-Step2.4~6-MyBatis/" class="article-date">
  <time datetime="2020-08-10T07:30:46.000Z" itemprop="datePublished">2020-08-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="主要步骤："><a href="#主要步骤：" class="headerlink" title="主要步骤："></a>主要步骤：</h3><p>1、MyBatis介绍和配置</p>
<p>2、连接数据库工具类MyBatisUtils</p>
<p>3、数据查询，插入，更新，删除操作</p>
<p>4、日志配置及查看</p>
<p>5、动态sql语句</p>
<p>6、二级缓存</p>
<p>7、1对多 ，多对1关联查询</p>
<p>8、分页查询插件</p>
<p>9、连接缓冲池C3P0</p>
<p>10、批量插入</p>
<p>11、注解开发</p>
<p>12、项目开发总结</p>
<span id="more"></span>

<h1 id="1-MyBatis介绍和配置"><a href="#1-MyBatis介绍和配置" class="headerlink" title="1-MyBatis介绍和配置"></a>1-MyBatis介绍和配置</h1><p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/1.png" alt="1"></p>
<p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/4.png" alt="4"></p>
<h3 id="配置mybatis"><a href="#配置mybatis" class="headerlink" title="配置mybatis"></a>配置mybatis</h3><p>pom.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.5.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.49&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/2.png" alt="2"></p>
<p>mybatis-config.xml文件的配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--设置默认指向的数据库--&gt;</span><br><span class="line">    &lt;environments default=&quot;dev&quot;&gt;</span><br><span class="line">        &lt;!--配置环境，不同的环境不同的id名字--&gt;</span><br><span class="line">        &lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">            &lt;!-- 采用JDBC方式对数据库事务进行commit/rollback --&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--采用连接池方式管理数据库连接--&gt;</span><br><span class="line">            &lt;!--            &lt;dataSource type=&quot;com.imooc.mybatis.datasource.C3P0DataSourceFactory&quot;&gt;--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/babytun?useUnicode=true&amp;amp;characterEncoding=UTF-8&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;</span><br><span class="line">&lt;!--                &lt;property name=&quot;initialPoolSize&quot; value=&quot;5&quot;/&gt;--&gt;</span><br><span class="line">&lt;!--                &lt;property name=&quot;maxPoolSize&quot; value=&quot;20&quot;/&gt;--&gt;</span><br><span class="line">&lt;!--                &lt;property name=&quot;minPoolSize&quot; value=&quot;5&quot;/&gt;--&gt;</span><br><span class="line">                &lt;!--...--&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">        &lt;environment id=&quot;prd&quot;&gt;</span><br><span class="line">            &lt;!-- 采用JDBC方式对数据库事务进行commit/rollback --&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;!--采用连接池方式管理数据库连接--&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://192.168.1.155:3306/babytun?useUnicode=true&amp;amp;characterEncoding=UTF-8&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/3.png" alt="3"></p>
<p>连接数据库时需要设置时区，不然会出错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql://localhost:3306?serverTimezone=GMT%2B8</span><br></pre></td></tr></table></figure>

<h1 id="2-工具类MyBatisUtils"><a href="#2-工具类MyBatisUtils" class="headerlink" title="2-工具类MyBatisUtils"></a>2-工具类MyBatisUtils</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public class MyBatisUtils &#123;</span><br><span class="line">    //利用static(静态)属于类不属于对象,且全局唯一</span><br><span class="line">    private static SqlSessionFactory sqlSessionFactory = null;</span><br><span class="line">    //利用静态块在初始化类时实例化sqlSessionFactory</span><br><span class="line">    static &#123;</span><br><span class="line">        Reader reader = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            reader = Resources.getResourceAsReader(&quot;mybatis-config.xml&quot;);</span><br><span class="line">            sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            //初始化错误时,通过抛出异常ExceptionInInitializerError通知调用者</span><br><span class="line">            throw new ExceptionInInitializerError(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * openSession 创建一个新的SqlSession对象</span><br><span class="line">     * @return SqlSession对象</span><br><span class="line">     */</span><br><span class="line">    public static SqlSession openSession()&#123;</span><br><span class="line">        //默认SqlSession对自动提交事务数据(commit)</span><br><span class="line">        //设置false代表关闭自动提交,改为手动提交事务数据</span><br><span class="line">        return sqlSessionFactory.openSession(false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 释放一个有效的SqlSession对象</span><br><span class="line">     * @param session 准备释放SqlSession对象</span><br><span class="line">     */</span><br><span class="line">    public static void closeSession(SqlSession session)&#123;</span><br><span class="line">        if(session != null)&#123;</span><br><span class="line">            session.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="3-MyBatis数据查询"><a href="#3-MyBatis数据查询" class="headerlink" title="3-MyBatis数据查询"></a>3-MyBatis数据查询</h1><p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/5.png" alt="5"></p>
<p>在mybatis-config.xml中添加配置mapper和驼峰命名映射</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;mappers/goods.xml&quot;&gt;&lt;/mapper&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;settings&gt;</span><br><span class="line">        &lt;!-- goods_id ==&gt; goodsId 驼峰命名转换 --&gt;</span><br><span class="line">        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br></pre></td></tr></table></figure>

<p>goods.xml配置示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;goods&quot;&gt;  //相当于包名字</span><br><span class="line">    &lt;select id=&quot;selectAll&quot; resultType=&quot;com.imooc.mybatis.entity.Goods&quot;&gt; //映射到实体类Goods</span><br><span class="line">        select * from t_goods order by goods_id desc limit 10</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<h5 id=""><a href="#" class="headerlink" title=""></a><!-- 单参数传递,使用parameterType指定参数的数据类型即可,SQL中#{value}提取参数--></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectById&quot; parameterType=&quot;Integer&quot; resultType=&quot;com.imooc.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">    select * from t_goods where goods_id = #&#123;value&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<!-- 多参数传递时,使用parameterType指定Map接口,SQL中#{key}提取参数 -->

<pre><code>&lt;select id=&quot;selectByPriceRange&quot; parameterType=&quot;java.util.Map&quot; resultType=&quot;com.imooc.mybatis.entity.Goods&quot;&gt;
    select * from t_goods
    where
      current_price between  #&#123;min&#125; and #&#123;max&#125;
    order by current_price
    limit 0,#&#123;limt&#125;
&lt;/select&gt;
</code></pre>
<!-- 利用LinkedHashMap保存多表关联结果
        MyBatis会将每一条记录包装为LinkedHashMap对象
        key是字段名  value是字段对应的值 , 字段类型根据表结构进行自动判断
        优点: 易于扩展,易于使用
        缺点: 太过灵活,无法进行编译时检查
     -->

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectGoodsMap&quot; resultType=&quot;java.util.LinkedHashMap&quot; flushCache=&quot;true&quot;&gt;</span><br><span class="line">     select g.* , c.category_name,&#x27;1&#x27; as test from t_goods g , t_category c</span><br><span class="line">     where g.category_id = c.category_id</span><br><span class="line"> &lt;/select&gt;	</span><br></pre></td></tr></table></figure>

<!--结果映射-->

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;rmGoods&quot; type=&quot;com.imooc.mybatis.dto.GoodsDTO&quot;&gt;</span><br><span class="line">        &lt;!--设置主键字段与属性映射--&gt;</span><br><span class="line">        &lt;id property=&quot;goods.goodsId&quot; column=&quot;goods_id&quot;&gt;&lt;/id&gt;</span><br><span class="line">        &lt;!--设置非主键字段与属性映射--&gt;</span><br><span class="line">        &lt;result property=&quot;goods.title&quot; column=&quot;title&quot;&gt;&lt;/result&gt;</span><br><span class="line">        &lt;result property=&quot;category.categoryId&quot; column=&quot;category_id&quot;&gt;&lt;/result&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;select id=&quot;selectGoodsDTO&quot; resultMap=&quot;rmGoods&quot;&gt;</span><br><span class="line">        select g.* , c.*,&#x27;1&#x27; as test from t_goods g , t_category c</span><br><span class="line">        where g.category_id = c.category_id</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h1 id="4-MyBatis数据插入"><a href="#4-MyBatis数据插入" class="headerlink" title="4-MyBatis数据插入"></a>4-MyBatis数据插入</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--flushCache=&quot;true&quot;在sql执行后强制清空缓存--&gt;</span><br><span class="line">    &lt;insert id=&quot;insert&quot; parameterType=&quot;com.imooc.mybatis.entity.Goods&quot; flushCache=&quot;true&quot;&gt;</span><br><span class="line">        INSERT INTO t_goods(title, sub_title, original_cost, current_price, discount, is_free_delivery, category_id)</span><br><span class="line">        VALUES (#&#123;title&#125; , #&#123;subTitle&#125; , #&#123;originalCost&#125;, #&#123;currentPrice&#125;, #&#123;discount&#125;, #&#123;isFreeDelivery&#125;, #&#123;categoryId&#125;)</span><br><span class="line">      &lt;!--&lt;selectKey resultType=&quot;Integer&quot; keyProperty=&quot;goodsId&quot; order=&quot;AFTER&quot;&gt;--&gt;</span><br><span class="line">          &lt;!--select last_insert_id()--&gt;</span><br><span class="line">      &lt;!--&lt;/selectKey&gt;--&gt;</span><br><span class="line">    &lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<h1 id="5-MyBatis数据更新"><a href="#5-MyBatis数据更新" class="headerlink" title="5-MyBatis数据更新"></a>5-MyBatis数据更新</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=&quot;update&quot; parameterType=&quot;com.imooc.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        UPDATE t_goods</span><br><span class="line">        SET</span><br><span class="line">          title = #&#123;title&#125; ,</span><br><span class="line">          sub_title = #&#123;subTitle&#125; ,</span><br><span class="line">          original_cost = #&#123;originalCost&#125; ,</span><br><span class="line">          current_price = #&#123;currentPrice&#125; ,</span><br><span class="line">          discount = #&#123;discount&#125; ,</span><br><span class="line">          is_free_delivery = #&#123;isFreeDelivery&#125; ,</span><br><span class="line">          category_id = #&#123;categoryId&#125;</span><br><span class="line">        WHERE</span><br><span class="line">          goods_id = #&#123;goodsId&#125;</span><br><span class="line">    &lt;/update&gt;</span><br></pre></td></tr></table></figure>

<h1 id="6-MyBatis数据删除"><a href="#6-MyBatis数据删除" class="headerlink" title="6-MyBatis数据删除"></a>6-MyBatis数据删除</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--delete from t_goods where goods_id in (1920,1921)--&gt;</span><br><span class="line">&lt;delete id=&quot;delete&quot; parameterType=&quot;Integer&quot;&gt;</span><br><span class="line">    delete from t_goods where goods_id = #&#123;value&#125;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>

<h1 id="7-MyBatis日志管理"><a href="#7-MyBatis日志管理" class="headerlink" title="7-MyBatis日志管理"></a>7-MyBatis日志管理</h1><p>pom.xml中添加依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.3&lt;/version&gt;  //经典版本</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>可以自己配置logback.xml文件 强制要求为该名字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">   &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">       &lt;encoder&gt;</span><br><span class="line">           &lt;pattern&gt;[%thread] %d&#123;HH:mm:ss.SSS&#125; %-5level %logger&#123;36&#125; - %msg%n&lt;/pattern&gt;</span><br><span class="line">       &lt;/encoder&gt;</span><br><span class="line">   &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">        日志输出级别(优先级高到低):</span><br><span class="line">        error: 错误 - 系统的故障日志</span><br><span class="line">        warn: 警告 - 存在风险或使用不当的日志</span><br><span class="line">        info: 一般性消息</span><br><span class="line">        debug: 程序内部用于调试信息</span><br><span class="line">        trace: 程序运行的跟踪信息</span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;root level=&quot;debug&quot;&gt;</span><br><span class="line">        &lt;appender-ref ref=&quot;console&quot;/&gt;</span><br><span class="line">    &lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h1 id="8-MyBatis动态sql"><a href="#8-MyBatis动态sql" class="headerlink" title="8-MyBatis动态sql"></a>8-MyBatis动态sql</h1><p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/6.png" alt="6"></p>
<h1 id="9-MyBatis二级缓存"><a href="#9-MyBatis二级缓存" class="headerlink" title="9-MyBatis二级缓存"></a>9-MyBatis二级缓存</h1><p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/7.png" alt="7"></p>
<p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/8.png" alt="8"></p>
<p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/9.png" alt="9"></p>
<h3 id="在需要开启二级缓存的xml中配置：例如goods-xml"><a href="#在需要开启二级缓存的xml中配置：例如goods-xml" class="headerlink" title="在需要开启二级缓存的xml中配置：例如goods.xml"></a>在需要开启二级缓存的xml中配置：例如goods.xml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--开启了二级缓存</span><br><span class="line">      eviction是缓存的清除策略,当缓存对象数量达到上限后,自动触发对应算法对缓存对象清除</span><br><span class="line">          1.LRU – 最近最少使用的:移除最长时间不被使用的对象。</span><br><span class="line">          2.FIFO – 先进先出:按对象进入缓存的顺序来移除它们。</span><br><span class="line">          3.SOFT – 软引用:移除基于垃圾回收器状态和软引用规则的对象。</span><br><span class="line">          4.WEAK – 弱引用:更积极地移除基于垃圾收集器状态和弱引用规则的对象。</span><br><span class="line"></span><br><span class="line">      flushInterval 代表间隔多长时间自动清空缓存,单位毫秒,600000毫秒 = 10分钟</span><br><span class="line">      size 缓存存储上限,用于保存对象或集合(1个集合算1个对象)的数量上限</span><br><span class="line">      readOnly 设置为true ,代表返回只读缓存,每次从缓存取出的是缓存对象本身.这种执行效率较高</span><br><span class="line">               设置为false , 代表每次取出的是缓存对象的&quot;副本&quot;,每一次取出的对象都是不同的,这种安全性较高</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;cache eviction=&quot;LRU&quot; flushInterval=&quot;600000&quot; size=&quot;512&quot; readOnly=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;!-- useCache=&quot;false&quot;代表不使用缓存 --&gt;</span><br><span class="line">  &lt;!--flushCache=&quot;true&quot;在sql执行后强制清空缓存--&gt;</span><br></pre></td></tr></table></figure>

<h1 id="10-OneToMany对象关联查询"><a href="#10-OneToMany对象关联查询" class="headerlink" title="10-OneToMany对象关联查询"></a>10-OneToMany对象关联查询</h1><h5 id="goods（1）-goodsdetail（n）-xml中配置："><a href="#goods（1）-goodsdetail（n）-xml中配置：" class="headerlink" title="goods（1）-goodsdetail（n）   xml中配置："></a>goods（1）-goodsdetail（n）   xml中配置：</h5><p>property要查询的对象 column根据什么查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">        resultMap可用于说明一对多或者多对一的映射逻辑</span><br><span class="line">        id 是resultMap属性引用的标志</span><br><span class="line">        type 指向One的实体(Goods)</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;resultMap id=&quot;rmGoods1&quot; type=&quot;com.imooc.mybatis.entity.Goods&quot;&gt;</span><br><span class="line">        &lt;!-- 映射goods对象的主键到goods_id字段 --&gt;</span><br><span class="line">        &lt;id column=&quot;goods_id&quot; property=&quot;goodsId&quot;&gt;&lt;/id&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">            collection的含义是,在</span><br><span class="line">            select * from t_goods limit 0,1 得到结果后,对所有Goods对象遍历得到goods_id字段值,</span><br><span class="line">            并代入到goodsDetail命名空间的findByGoodsId的SQL中执行查询,</span><br><span class="line">            将得到的&quot;商品详情&quot;集合赋值给goodsDetails List对象.</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;collection property=&quot;goodsDetails&quot; select=&quot;goodsDetail.selectByGoodsId&quot;</span><br><span class="line">                    column=&quot;goods_id&quot;/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;select id=&quot;selectOneToMany&quot; resultMap=&quot;rmGoods1&quot;&gt;</span><br><span class="line">        select * from t_goods limit 0,10</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h1 id="11-ManyToOne对象关联查询"><a href="#11-ManyToOne对象关联查询" class="headerlink" title="11-ManyToOne对象关联查询"></a>11-ManyToOne对象关联查询</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;rmGoodsDetail&quot; type=&quot;com.imooc.mybatis.entity.GoodsDetail&quot;&gt;</span><br><span class="line">     &lt;id column=&quot;gd_id&quot; property=&quot;gdId&quot;/&gt;  </span><br><span class="line">     &lt;result column=&quot;goods_id&quot; property=&quot;goodsId&quot;/&gt;</span><br><span class="line">     //MyBatis中通过goods_id来查找goods时会导致goods_id消失的问题，因此需要加上上一句。</span><br><span class="line">     &lt;association property=&quot;goods&quot; select=&quot;goods.selectById&quot; column=&quot;goods_id&quot;&gt;&lt;/association&gt;</span><br><span class="line">     </span><br><span class="line"> &lt;/resultMap&gt;</span><br><span class="line"> &lt;select id=&quot;selectManyToOne&quot; resultMap=&quot;rmGoodsDetail&quot;&gt;</span><br><span class="line">     select * from t_goods_detail limit 0,20</span><br><span class="line"> &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h1 id="12-PageHelper-MyBatis插件"><a href="#12-PageHelper-MyBatis插件" class="headerlink" title="12- PageHelper-MyBatis插件"></a>12- PageHelper-MyBatis插件</h1><p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/10.png" alt="10"></p>
<h5 id="pom-xml添加依赖："><a href="#pom-xml添加依赖：" class="headerlink" title="pom.xml添加依赖："></a>pom.xml添加依赖：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;pagehelper&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.2.0&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.jsqlparser&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jsqlparser&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h5 id="mybatis-config-xml中配置插件："><a href="#mybatis-config-xml中配置插件：" class="headerlink" title="mybatis-config.xml中配置插件："></a>mybatis-config.xml中配置插件：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--启用Pagehelper分页插件--&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin interceptor=&quot;com.github.pagehelper.PageInterceptor&quot;&gt;</span><br><span class="line">            &lt;!--设置数据库类型--&gt;</span><br><span class="line">            &lt;property name=&quot;helperDialect&quot; value=&quot;mysql&quot;/&gt;</span><br><span class="line">            &lt;!--分页合理化--&gt;</span><br><span class="line">            &lt;property name=&quot;reasonable&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br></pre></td></tr></table></figure>

<h5 id="主程序："><a href="#主程序：" class="headerlink" title="主程序："></a>主程序：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> PageHelper.startPage(2,10); //2 表示第二页，10表示一页有10个</span><br><span class="line">Page&lt;Goods&gt; page = (Page) session.selectList(&quot;goods.selectPage&quot;);</span><br><span class="line">List&lt;Goods&gt; data = page.getResult();//当前页数据</span><br></pre></td></tr></table></figure>

<h1 id="13-MyBatis配置C3P0连接池"><a href="#13-MyBatis配置C3P0连接池" class="headerlink" title="13-MyBatis配置C3P0连接池"></a>13-MyBatis配置C3P0连接池</h1><h5 id="配置依赖文件："><a href="#配置依赖文件：" class="headerlink" title="配置依赖文件："></a>配置依赖文件：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.mchange&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;c3p0&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.9.5.5&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h5 id="新建C3P0DataSourceFactory类："><a href="#新建C3P0DataSourceFactory类：" class="headerlink" title="新建C3P0DataSourceFactory类："></a>新建C3P0DataSourceFactory类：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * C3P0与MyBatis兼容使用的数据源工厂类</span><br><span class="line"> */</span><br><span class="line">public class C3P0DataSourceFactory extends UnpooledDataSourceFactory &#123;</span><br><span class="line">    public C3P0DataSourceFactory()&#123;</span><br><span class="line">        this.dataSource = new ComboPooledDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="mybatis-config-xml中配置连接池："><a href="#mybatis-config-xml中配置连接池：" class="headerlink" title="mybatis-config.xml中配置连接池："></a>mybatis-config.xml中配置连接池：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;environment id=&quot;dev&quot;&gt;</span><br><span class="line">           &lt;!-- 采用JDBC方式对数据库事务进行commit/rollback --&gt;</span><br><span class="line">           &lt;transactionManager type=&quot;JDBC&quot;&gt;&lt;/transactionManager&gt;</span><br><span class="line">           &lt;!--采用连接池方式管理数据库连接--&gt;</span><br><span class="line">           &lt;!--&lt;dataSource type=&quot;POOLED&quot;&gt;--&gt;</span><br><span class="line">           &lt;dataSource type=&quot;com.imooc.mybatis.datasource.C3P0DataSourceFactory&quot;&gt;</span><br><span class="line">               &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/babytun?useUnicode=true&amp;amp;characterEncoding=UTF-8&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;user&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;initialPoolSize&quot; value=&quot;5&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;maxPoolSize&quot; value=&quot;20&quot;/&gt;</span><br><span class="line">               &lt;property name=&quot;minPoolSize&quot; value=&quot;5&quot;/&gt;</span><br><span class="line">               &lt;!--...--&gt;</span><br><span class="line">           &lt;/dataSource&gt;</span><br><span class="line">       &lt;/environment&gt;</span><br></pre></td></tr></table></figure>

<h1 id="14-MyBatis批量插入"><a href="#14-MyBatis批量插入" class="headerlink" title="14-MyBatis批量插入"></a>14-MyBatis批量插入</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;batchInsert&quot; parameterType=&quot;java.util.List&quot;&gt;</span><br><span class="line">       INSERT INTO t_goods(title, sub_title, original_cost, current_price, discount, is_free_delivery, category_id)</span><br><span class="line">       VALUES</span><br><span class="line">       &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; index=&quot;index&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">           (#&#123;item.title&#125;,#&#123;item.subTitle&#125;, #&#123;item.originalCost&#125;, #&#123;item.currentPrice&#125;, #&#123;item.discount&#125;, #&#123;item.isFreeDelivery&#125;, #&#123;item.categoryId&#125;)</span><br><span class="line">       &lt;/foreach&gt;</span><br><span class="line">   &lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<p>批量删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;delete id=&quot;batchDelete&quot; parameterType=&quot;java.util.List&quot;&gt;</span><br><span class="line">    DELETE FROM t_goods WHERE goods_id in</span><br><span class="line">    &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; index=&quot;index&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">    &lt;/foreach&gt;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>

<h1 id="15-MyBatis注解开发"><a href="#15-MyBatis注解开发" class="headerlink" title="15-MyBatis注解开发"></a>15-MyBatis注解开发</h1><p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/11.png" alt="11"></p>
<h5 id="取消编写mapper，而是直接在dao包中写dao类，"><a href="#取消编写mapper，而是直接在dao包中写dao类，" class="headerlink" title="取消编写mapper，而是直接在dao包中写dao类，"></a>取消编写mapper，而是直接在dao包中写dao类，</h5><h5 id="在mybatis-config-xml中配置导入dao包"><a href="#在mybatis-config-xml中配置导入dao包" class="headerlink" title="在mybatis-config.xml中配置导入dao包"></a>在mybatis-config.xml中配置导入dao包</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;!--&lt;mapper class=&quot;com.imooc.mybatis.dao.GoodsDAO&quot;/&gt;--&gt;</span><br><span class="line">    &lt;package name=&quot;com.imooc.mybatis.dao&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>

<h5 id="例如：查询数据"><a href="#例如：查询数据" class="headerlink" title="例如：查询数据"></a>例如：查询数据</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface GoodsDAO &#123;</span><br><span class="line">    @Select(&quot;select * from t_goods where current_price between  #&#123;min&#125; and #&#123;max&#125; order by current_price limit 0,#&#123;limt&#125;&quot;)</span><br><span class="line">    public List&lt;Goods&gt; selectByPriceRange(@Param(&quot;min&quot;) Float min ,@Param(&quot;max&quot;) Float max ,@Param(&quot;limt&quot;) Integer limt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">session = MyBatisUtils.openSession();</span><br><span class="line">           GoodsDAO goodsDAO = session.getMapper(GoodsDAO.class);</span><br><span class="line">           List list = goodsDAO.selectByPriceRange(100f,500f,20);</span><br><span class="line">           System.out.println(list.size());</span><br></pre></td></tr></table></figure>

<h5 id="插入数据并返回Id值"><a href="#插入数据并返回Id值" class="headerlink" title="插入数据并返回Id值"></a>插入数据并返回Id值</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Insert(&quot;INSERT INTO t_goods(title, sub_title, original_cost, current_price, discount, is_free_delivery, category_id) VALUES (#&#123;title&#125; , #&#123;subTitle&#125; , #&#123;originalCost&#125;, #&#123;currentPrice&#125;, #&#123;discount&#125;, #&#123;isFreeDelivery&#125;, #&#123;categoryId&#125;)&quot;)</span><br><span class="line">   //&lt;selectKey&gt;</span><br><span class="line">   @SelectKey(statement = &quot;select last_insert_id()&quot; , before = false , keyProperty = &quot;goodsId&quot; , resultType = Integer.class)</span><br><span class="line">   public int insert(Goods goods);</span><br></pre></td></tr></table></figure>

<h5 id="Results映射"><a href="#Results映射" class="headerlink" title="Results映射"></a>Results映射</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Select(&quot;select *from catalog where id=#&#123;id&#125;&quot;)</span><br><span class="line">    @Results(id=&quot;all&quot;,value=&#123;</span><br><span class="line">            @Result(column = &quot;id&quot;, property = &quot;id&quot;, id = true),</span><br><span class="line">            @Result(column = &quot;title&quot;, property = &quot;title&quot;),</span><br><span class="line">            @Result(column = &quot;pid&quot;, property = &quot;pid&quot;),</span><br><span class="line">            @Result(column = &quot;info&quot;,property = &quot;info&quot;),</span><br><span class="line">            @Result(column = &quot;id&quot;, property = &quot;children&quot;,many = @Many(select = &quot;selectByPid&quot;))</span><br><span class="line">    &#125;)</span><br><span class="line">    Catalog select(int id);</span><br><span class="line"></span><br><span class="line">    @Select(&quot;select *from catalog where pid=#&#123;pid&#125;&quot;)</span><br><span class="line">    @ResultMap(&quot;all&quot;)</span><br><span class="line">    List&lt;Catalog&gt; selectByPid(int pid);</span><br></pre></td></tr></table></figure>

<h3 id="总结：xml的方式适合大型项目，注解的形式适合小型项目的快速开发"><a href="#总结：xml的方式适合大型项目，注解的形式适合小型项目的快速开发" class="headerlink" title="总结：xml的方式适合大型项目，注解的形式适合小型项目的快速开发"></a>总结：xml的方式适合大型项目，注解的形式适合小型项目的快速开发</h3><h1 id="16-项目开发总结"><a href="#16-项目开发总结" class="headerlink" title="16-项目开发总结"></a>16-项目开发总结</h1><h3 id="1、web-xml配置"><a href="#1、web-xml配置" class="headerlink" title="1、web.xml配置"></a>1、web.xml配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span><br><span class="line">         version=&quot;4.0&quot;&gt;</span><br><span class="line"> &lt;/web-app&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2、整个实现逻辑："><a href="#2、整个实现逻辑：" class="headerlink" title="2、整个实现逻辑："></a>2、整个实现逻辑：</h3><p>持久层（底层，sql语句实现，dao）-&gt;业务层（interface和具体实现方法)-&gt;表现层（调用业务层对页面处理）-&gt;实现jsp页面</p>
<h3 id="3、servlet如果要将数据传递给jsp页面要用转发，重定向的话是传向新的链接，所以是接受不到数据的。"><a href="#3、servlet如果要将数据传递给jsp页面要用转发，重定向的话是传向新的链接，所以是接受不到数据的。" class="headerlink" title="3、servlet如果要将数据传递给jsp页面要用转发，重定向的话是传向新的链接，所以是接受不到数据的。"></a>3、servlet如果要将数据传递给jsp页面要用转发，重定向的话是传向新的链接，所以是接受不到数据的。</h3><h3 id="4、当大量的操作都需要用到某个列表中的大量数据的时候，可以采取将这个数据放入到缓冲区中，这样在保证不会修改的情况下只需要初始化一次，当有发生修改时，再将他在缓冲区中的修改，例如放入到Application中：增加一个内容监听器"><a href="#4、当大量的操作都需要用到某个列表中的大量数据的时候，可以采取将这个数据放入到缓冲区中，这样在保证不会修改的情况下只需要初始化一次，当有发生修改时，再将他在缓冲区中的修改，例如放入到Application中：增加一个内容监听器" class="headerlink" title="4、当大量的操作都需要用到某个列表中的大量数据的时候，可以采取将这个数据放入到缓冲区中，这样在保证不会修改的情况下只需要初始化一次，当有发生修改时，再将他在缓冲区中的修改，例如放入到Application中：增加一个内容监听器"></a>4、当大量的操作都需要用到某个列表中的大量数据的时候，可以采取将这个数据放入到缓冲区中，这样在保证不会修改的情况下只需要初始化一次，当有发生修改时，再将他在缓冲区中的修改，例如放入到Application中：增加一个内容监听器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">分类树：</span><br><span class="line">public class CatalogTreeListener implements ServletContextListener &#123;</span><br><span class="line">    private CatalogBiz catalogBiz=new CatalogBizImpl();</span><br><span class="line">    public void contextInitialized(ServletContextEvent sce) &#123;</span><br><span class="line">        Catalog root =catalogBiz.getRoot();</span><br><span class="line">        sce.getServletContext().setAttribute(&quot;root&quot;,root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">在需要修改的时候：</span><br><span class="line">        request.getServletContext().setAttribute(&quot;root&quot;,root);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5、在以后实现中需要考虑单例模型。"><a href="#5、在以后实现中需要考虑单例模型。" class="headerlink" title="5、在以后实现中需要考虑单例模型。"></a>5、在以后实现中需要考虑单例模型。</h3><p><img src="/images/Java-Stage3-Step2.4~5-MyBatis/12.png" alt="12"></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://yoursite.com/2020/08/10/Java-Stage3-Step2.4~6-MyBatis/" data-id="cll1oa29d000ml9cpff1jduxs" class="article-share-link">Share</a>
      

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/08/10/Java-Stage4-Step1-Spring/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2020/08/07/Java-Stage2-Step5.1-Linux/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Tukeke<br>
      Theme <a href="https://github.com/Tukekehaohaonuli/" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>